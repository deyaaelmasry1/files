<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>File Uploader</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">
  <div class="bg-white p-6 rounded-xl shadow-md w-96">
    <h1 class="text-2xl font-bold mb-4 text-center">Upload File</h1>
    <input id="fileInput" type="file" class="mb-4 w-full border p-2 rounded">
    <button onclick="uploadFile()" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">Upload</button>
    
    <!-- Improved status display area -->
    <div id="status" class="mt-4 p-3 rounded hidden"></div>
    
    <!-- Detailed error display -->
    <div id="errorDetails" class="mt-2 p-3 bg-red-50 text-red-700 rounded text-sm hidden"></div>
  </div>

  <script>
    async function uploadFile() {
      const fileInput = document.getElementById("fileInput");
      const status = document.getElementById("status");
      const errorDetails = document.getElementById("errorDetails");
      
      // Reset displays
      status.classList.add("hidden");
      errorDetails.classList.add("hidden");
      
      if (!fileInput.files.length) {
        showError("Please select a file.");
        return;
      }

      const file = fileInput.files[0];
      
      // File size validation (e.g., 5MB limit)
      if (file.size > 5 * 1024 * 1024) {
        showError("File size exceeds 5MB limit.");
        return;
      }

      try {
        status.innerText = "Uploading...";
        status.className = "mt-4 p-3 bg-blue-50 text-blue-700 rounded";
        status.classList.remove("hidden");

        const content = await file.arrayBuffer();
        const base64 = btoa(String.fromCharCode(...new Uint8Array(content)));

        const response = await fetch("https://api.github.com/repos/YOUR_USERNAME/YOUR_REPO/dispatches", {
          method: "POST",
          headers: {
            "Authorization": "Bearer " + "YOUR_PAT_TOKEN",
            "Accept": "application/vnd.github.v3+json",
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            event_type: "upload-file",
            client_payload: {
              name: file.name,
              content: base64
            }
          })
        });

        const result = await response.json();
        
        if (response.ok) {
          status.innerHTML = `✅ Upload successful!<br>
            <a href="https://YOUR_USERNAME.github.io/YOUR_REPO/uploads/${file.name}" 
               target="_blank" 
               class="text-blue-600 underline mt-2 inline-block">
               View File
            </a>`;
          status.className = "mt-4 p-3 bg-green-50 text-green-700 rounded";
        } else {
          let errorMsg = "Upload failed";
          if (result.message) {
            errorMsg += `: ${result.message}`;
            if (result.errors) {
              errorMsg += `<br>Details: ${JSON.stringify(result.errors)}`;
            }
          }
          showError(errorMsg);
        }
      } catch (error) {
        let errorMsg = "An error occurred during upload";
        if (error.message) {
          errorMsg += `: ${error.message}`;
        }
        showError(errorMsg);
        console.error("Upload error:", error);
      }
    }

    function showError(message) {
      const status = document.getElementById("status");
      const errorDetails = document.getElementById("errorDetails");
      
      status.innerHTML = `❌ ${message.split('<br>')[0]}`;
      status.className = "mt-4 p-3 bg-red-50 text-red-700 rounded";
      status.classList.remove("hidden");
      
      // Show detailed error if available
      if (message.includes('<br>')) {
        errorDetails.innerHTML = message.split('<br>').slice(1).join('<br>');
        errorDetails.classList.remove("hidden");
      }
    }
  </script>
</body>
</html>
